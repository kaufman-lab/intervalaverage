<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Time-Weighted Averaging for Interval Data • intervalaverage</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Time-Weighted Averaging for Interval Data">
<meta property="og:description" content="Perform fast and memory efficient time-weighted averaging of values 
    measured over intervals into new arbitrary intervals. 
	This package is useful in the context of data measured or represented
	as constant values over intervals on a one-dimensional discrete axis 
	(e.g. time-integrated averages of a curve over defined periods). 
	This package was written specifically to deal with air 
	pollution data recorded or predicted as averages over sampling periods. 
	Data in this format often needs to be shifted to non-aligned periods 
	or averaged up to periods of longer duration (e.g. averaging data measured over 
	sequential non-overlapping periods to calendar years). ">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">intervalaverage</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.9.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/intervalaverage-advanced.html">Introduction to intervalaverage</a>
    </li>
    <li>
      <a href="articles/intervalaverage-intro.html">Introduction to `intervalaverage`</a>
    </li>
    <li>
      <a href="articles/intervalaverage-technicaloverview.html">Technical overview of the intervalaverage function</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="intervalaverage">intervalaverage<a class="anchor" aria-label="anchor" href="#intervalaverage"></a>
</h1></div>
<!-- badges: start -->
<p>Perform fast and memory efficient time-weighted averaging of values measured over intervals into new arbitrary intervals.</p>
<p>This package is useful in the context of data measured or represented as constant values over intervals on a one-dimensional discrete axis (e.g. time-integrated averages of a curve over defined periods).</p>
<p>The intervalaverage package was written specifically to deal with air pollution data recorded or predicted as averages over sampling periods. Data in this format often needs to be shifted to non-aligned periods or averaged up to longer durations (e.g. averaging data measured over sequential non-overlapping periods to calendar years).</p>
<p>This package makes careful use of optimized data.table syntax to reduce copying so it is well suited to deal with large datasets. The function inputs and return values are always data.tables (with values, interval starts and interval ends stored as columns) which provide a straightforward representation of the data facilitating direct inspection and manipulation via data.table’s standard interface. Functions also accept optional grouping variables as arguments; these group-by operations get passed to data.table which avoids the overhead of looping directly in R.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the package from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"intervalaverage"</span>)</span></code></pre></div>
<p>Or you can install the current development version of the from <a href="https://github.com/kaufman-lab/intervalaverage" class="external-link">GitHub</a>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("devtools")</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(devtools)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install_github</span>(<span class="st">"kaufman-lab/intervalaverage"</span>, <span class="st">"main"</span>, <span class="at">build_vignettes=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>or you can manually clone this repository from github and install from source.</p>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kaufman-lab.github.io/intervalaverage/">intervalaverage</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: data.table</span></code></pre></div>
<p>Consider some PM2.5 data measured over periods occurring over a repeating 7-day schedule:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>start<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1L</span>,by<span class="op">=</span><span class="fl">7L</span>,length<span class="op">=</span><span class="fl">6</span><span class="op">)</span>,
                 end<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">7L</span>,by<span class="op">=</span><span class="fl">7L</span>,length<span class="op">=</span><span class="fl">6</span><span class="op">)</span>,
                 pm25<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">12</span>,<span class="fl">8</span>,<span class="fl">14</span>,<span class="fl">22</span>,<span class="fl">18</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;    start end pm25</span>
<span class="co">#&gt; 1:     1   7   10</span>
<span class="co">#&gt; 2:     8  14   12</span>
<span class="co">#&gt; 3:    15  21    8</span>
<span class="co">#&gt; 4:    22  28   14</span>
<span class="co">#&gt; 5:    29  35   22</span>
<span class="co">#&gt; 6:    36  42   18</span></code></pre></div>
<p>Note that the start and end columns define closed intervals (i.e. inclusive).</p>
<p>Imagine that we would like these PM2.5 measurements to be represented over a different set of intervals, such as the following 7-day schedule which does not align cleanly with the intervals in x:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>start<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">3L</span>,by<span class="op">=</span><span class="fl">7L</span>,length<span class="op">=</span><span class="fl">6</span><span class="op">)</span>,
                 end<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">9L</span>,by<span class="op">=</span><span class="fl">7L</span>,length<span class="op">=</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;    start end</span>
<span class="co">#&gt; 1:     3   9</span>
<span class="co">#&gt; 2:    10  16</span>
<span class="co">#&gt; 3:    17  23</span>
<span class="co">#&gt; 4:    24  30</span>
<span class="co">#&gt; 5:    31  37</span>
<span class="co">#&gt; 6:    38  44</span></code></pre></div>
<p>Representing the PM25 measurements over the exact intervals in y is not strictly possible, since each y interval contains two x intervals which only partially overlap.</p>
<p>While there are several ways to compromise and approximate a representation of x over the periods in y, one reasonable approach is to average all the values of PM2.5 in x occuring over the interval of y. But since the two overlap durations of the two x periods into a single y period are unequal, the PM2.5 values should be averaged in a way that takes the duration of overlap into account. That is to say, we need a time-weighted average of values of x into intervals in y.</p>
<p>This is the exact purpose of the intervalaverage function:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/intervalaverage.html">intervalaverage</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>,interval_vars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"start"</span>,<span class="st">"end"</span><span class="op">)</span>,
                value_vars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pm25"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;    start end      pm25 yduration xduration nobs_pm25 xminstart xmaxend</span>
<span class="co">#&gt; 1:     3   9 10.571429         7         7         7         3       9</span>
<span class="co">#&gt; 2:    10  16 10.857143         7         7         7        10      16</span>
<span class="co">#&gt; 3:    17  23  9.714286         7         7         7        17      23</span>
<span class="co">#&gt; 4:    24  30 16.285714         7         7         7        24      30</span>
<span class="co">#&gt; 5:    31  37 20.857143         7         7         7        31      37</span>
<span class="co">#&gt; 6:    38  44        NA         7         5         5        38      42</span>
<span class="co">#&gt;    maxgap_pm25</span>
<span class="co">#&gt; 1:           0</span>
<span class="co">#&gt; 2:           0</span>
<span class="co">#&gt; 3:           0</span>
<span class="co">#&gt; 4:           0</span>
<span class="co">#&gt; 5:           0</span>
<span class="co">#&gt; 6:           2</span></code></pre></div>
<p>(Note that the interval average package always assumes specified intervals are closed aka inclusive)</p>
<p>The pm25 value of 10.571429 is equal to <code>(5/7)*10 + (2/7)*12</code>, where <code>5/7</code> and <code>2/7</code> are the respective time-weights of the the PM2.5 values based on their respective durations of overlap with the period <code>[3,9]</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">z</span><span class="op">[</span><span class="fl">1</span>,<span class="va">pm25</span><span class="op">]</span>, <span class="op">(</span><span class="fl">5</span><span class="op">/</span><span class="fl">7</span><span class="op">)</span><span class="op">*</span><span class="fl">10</span> <span class="op">+</span> <span class="op">(</span><span class="fl">2</span><span class="op">/</span><span class="fl">7</span><span class="op">)</span><span class="op">*</span><span class="fl">12</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>Note that in z the average value of PM2.5 is missing (NA) for the final period in y. This is because there is insufficient PM25 to calculate an average. By using a looser completeness requirements we can get an average for this period in y (in general, this will just be the mean of non-missing values in x):</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/intervalaverage.html">intervalaverage</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>,interval_vars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"start"</span>,<span class="st">"end"</span><span class="op">)</span>,
                value_vars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pm25"</span><span class="op">)</span>,required_percentage <span class="op">=</span> <span class="fl">70</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;    start end      pm25 yduration xduration nobs_pm25 xminstart xmaxend</span>
<span class="co">#&gt; 1:     3   9 10.571429         7         7         7         3       9</span>
<span class="co">#&gt; 2:    10  16 10.857143         7         7         7        10      16</span>
<span class="co">#&gt; 3:    17  23  9.714286         7         7         7        17      23</span>
<span class="co">#&gt; 4:    24  30 16.285714         7         7         7        24      30</span>
<span class="co">#&gt; 5:    31  37 20.857143         7         7         7        31      37</span>
<span class="co">#&gt; 6:    38  44 18.000000         7         5         5        38      42</span>
<span class="co">#&gt;    maxgap_pm25</span>
<span class="co">#&gt; 1:           0</span>
<span class="co">#&gt; 2:           0</span>
<span class="co">#&gt; 3:           0</span>
<span class="co">#&gt; 4:           0</span>
<span class="co">#&gt; 5:           0</span>
<span class="co">#&gt; 6:           2</span></code></pre></div>
<p>There is much more described in the vignette. For example, it is possible to calculate averages within a grouping variable. For example if PM2.5 were measured at multiple locations, you could take the average separately at each location in one call to the <code>intervalaverage</code> function. Averaging intervals need not be the same for each locations. See the vignette for examples.</p>
</div>
<div class="section level2">
<h2 id="vignette">Vignette<a class="anchor" aria-label="anchor" href="#vignette"></a>
</h2>
<p>Read the intro vignette for a demonstration of the core package functions.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(intervalaverage)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">vignette</span>(<span class="st">"intervalaverage-intro"</span>)</span></code></pre></div>
<p>More detail is on using the package is available in the advanced vignette.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vignette</span>(<span class="st">"intervalaverage-advanced"</span>)</span></code></pre></div>
<p>For an overview of the internals of the <code>intervalaverage</code> function, see the technical vignette:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vignette</span>(<span class="st">"intervalaverage-technicaloverview"</span>)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=intervalaverage" class="external-link">View on CRAN</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing intervalaverage</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Michael Young <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.com/kaufman-lab/intervalaverage" class="external-link"><img src="https://travis-ci.com/kaufman-lab/intervalaverage.svg?branch=main" alt="Travis build status"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Michael Young.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
