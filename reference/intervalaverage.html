<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>time-weighted average of values measured over intervals — intervalaverage • intervalaverage</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="time-weighted average of values measured over intervals — intervalaverage"><meta property="og:description" content="intervalaverage takes values recorded over
non-overlapping intervals and averages them to defined intervals, possibly within
groups (individuals/monitors/locations/etc).  This function could be used to take averages over long
intervals
of values measured over short intervals and/or to take short &quot;averages&quot; of values measured over
longer intervals (ie, downsample without smoothing). Measurement intervals and averaging intervals need
not align. In the event that an averaging interval contains more than one measurement interval,
a weighted average is calculated (ie each measurement is weighted on the duration of its interval's
overlap with the averaging period interval)."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">intervalaverage</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.9.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/intervalaverage-advanced.html">Introduction to intervalaverage</a>
    </li>
    <li>
      <a href="../articles/intervalaverage-intro.html">Introduction to `intervalaverage`</a>
    </li>
    <li>
      <a href="../articles/intervalaverage-technicaloverview.html">Technical overview of the intervalaverage function</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>time-weighted average of values measured over intervals</h1>
    
    <div class="hidden name"><code>intervalaverage.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>intervalaverage</code> takes values recorded over
non-overlapping intervals and averages them to defined intervals, possibly within
groups (individuals/monitors/locations/etc).  This function could be used to take averages over long
intervals
of values measured over short intervals and/or to take short "averages" of values measured over
longer intervals (ie, downsample without smoothing). Measurement intervals and averaging intervals need
not align. In the event that an averaging interval contains more than one measurement interval,
a weighted average is calculated (ie each measurement is weighted on the duration of its interval's
overlap with the averaging period interval).</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">intervalaverage</span><span class="op">(</span>
  <span class="va">x</span>,
  <span class="va">y</span>,
  <span class="va">interval_vars</span>,
  <span class="va">value_vars</span>,
  group_vars <span class="op">=</span> <span class="cn">NULL</span>,
  required_percentage <span class="op">=</span> <span class="fl">100</span>,
  skip_overlap_check <span class="op">=</span> <span class="cn">FALSE</span>,
  verbose <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>a data.table containing values measured over intervals. see
<code>interval_vars</code> parameter
for how to specify interval columns and <code>value_vars</code> for how to
specify value columns.
intervals in <code>x</code> must must be completely non-overlapping within
groups defined by group_vars. if <code>group_vars</code> is specified (non-<code>NULL</code>), <code>x</code> must
also contain columns specified in <code>group_vars</code>.</p></dd>
<dt>y</dt>
<dd><p>a data.table object containing intervals over which averages of <code>x</code> values should be computed.
averaging intervals in <code>y</code>, unlike measurement intervals in <code>x</code>, may be overlapping within groups.
if <code>group_vars</code> is specified (non-<code>NULL</code>),  <code>y</code> must contains those <code>group_vars</code> column names
(and this would allow different averaging periods for each group)</p></dd>
<dt>interval_vars</dt>
<dd><p>a length-2 character vector of column names in both <code>x</code> and <code>y</code>.
These column names specify columns in x and y that define
closed (inclusive) starting and ending intervals. The column name
specifying the lower-bound column must be specified first.
these columns in x and y must all be of the same class and either be integer or IDate.
The interval_vars character vector cannot be named. This is reserved for future use allowing
different interval_vars column names in x and y.</p></dd>
<dt>value_vars</dt>
<dd><p>a character vector of column names in <code>x</code>. This specifies
the columns to be averaged.</p></dd>
<dt>group_vars</dt>
<dd><p>A character vector of column names in both x and y.
The interaction of
these variables define groups in which averages of <code>x</code> values will be taken.
specifying subjects/monitors/locations within which to take averages.
By default this is <code>NULL</code>, in which case averages are taken over the entire <code>x</code>
dataset for each <code>y</code> period.
The group_vars character vector cannot be named. This is reserved for future use allowing
different interval_vars column names in x and y.</p></dd>
<dt>required_percentage</dt>
<dd><p>This percentage of the duration of each (possibly group-specific)
<code>y</code> interval must be observed
and nonmissing for a specific <code>value_var</code> in <code>x</code> in order for the return table to
contain a nonmissing average of the <code>value_var</code> for that <code>y</code> interval.  If the percentage
of the nonmissing <code>value_var</code> observations is less than <code>required_percentage</code> an NA will be be returned
for that average.
The default is 100, meaning that if <em>any</em> portion of a <code>y</code> interval is either not recorded or
missing in <code>x</code>, then the corresponding return row will contain a an NA for the average of that
<code>value_var</code>.</p></dd>
<dt>skip_overlap_check</dt>
<dd><p>by default, FALSE. setting this to TRUE will skip
internal checks to make sure x intervals are non-overlapping within
groups defined by group_vars.
intervals in x must be non-overlapping,
but you may want to skip this check if you've  already checked this because
it is computationally intensive for large datasets.</p></dd>
<dt>verbose</dt>
<dd><p>include printed timing information? by default, FALSE</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>returns a data.table object.
Rows of the return data.table correspond to intervals from y. i.e, the number
of rows of the return will be the number of rows of y.
Columns of the returned data.table are as follows: <br></p><ul><li><p>grouping variables as specified in <code>group_vars</code> <br></p></li>
<li><p>interval columns corresponding to intervals in y. These columns are named the
same they were in x and y and as specified in <code>interval_vars</code></p></li>
<li><p>value variable columns from x, averaged to periods in y.
named the same as they were in x <br></p></li>
<li><p><code>yduration</code>: the length of the interval (ie as a count) specified in y <br></p></li>
<li><p><code>xduration</code>: the total length of the intervals (ie as a count)
from x that fall into this interval from y. this will be equal to
yduration if x is comprehensive for (ie, fully covers)  this interval from y. <br></p></li>
<li><p><code>nobs_&lt;value_vars&gt;</code>: for each <code>value_var</code> specified, this is the count of
times (or whatever the units of the intervals are)
where there are non-missing values in x that fall into the specified interval from y. this will be
equal to xduration if the value_var contains no NA values over the y
interval. If there are NAs in value variables, then <code>nobs_&lt;value_vars&gt;</code>
will be different from <code>xduration</code> and won't necessarily be all the same
for each value_var.</p></li>
<li><p><code>xminstart</code>: For each returned interval (ie the intervals from Y) the minimum of the
start intervals represented in x.  If the start of the earliest x interval is less than the start
of the y interval, the minimum of the y interval is returned. Note, this is the minimum start
time in x matching with the y interval whether or not any value_vars were missing or not for that start time.
If you need non-missing minimum start times, you could remove NA intervals from
x prior to calling intervalaverage (this would need to be done separately for each value_var).</p></li>
<li><p><code>xmaxend</code>:  similar to xminstart but the maximum of the end intervals represented in x.
Again, this does not pay attention to whether the interval in x had non-missing value_vars.</p></li>
<li><p><code>maxgap_&lt;value_vars&gt;</code> For each <code>value_var</code> specified, this is the length of the largest
concurrent run of times (or whatever the units of intervals are) for which that value variable is missing
(either structurally missing ie--no intervals at all in x--or missing with an NA or any combination thereof).</p></li>
</ul></div>
    <div id="details">
    <h2>Details</h2>
    <p>All intervals are treated as closed (ie inclusive of the start and end values in interval_vars)</p>
<p>x and y are not copied but rather passed by reference to function internals
but the order of these data.tables is restored on function completion or error,</p>
<p>When required_percentage is less than 100, xminstart and xmaxend may be useful to
determine whether an average meets specified coverage requirements in terms of not
just percent of missingness but whether values are represented through the range of the y interval</p>
<p>maxgap variables may be useful in determing whether an average from incomplete data may be
representative of the true unknowable average (because of missingness) beyond what's already
accounted for based counts/percentage of non-missing values. Large runs of missing
values over time (or whatever the units of intervals are) mean missingness is not equally
distributed through the period.  However, note that this gap information is simply returned and
does not affect whether the average value is returned as NA or not--you'll need to apply your own
criteria using this (these) maxgap variables.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>start<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1L</span>,by<span class="op">=</span><span class="fl">7L</span>,length<span class="op">=</span><span class="fl">6</span><span class="op">)</span>,</span>
<span class="r-in">               end<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">7L</span>,by<span class="op">=</span><span class="fl">7L</span>,length<span class="op">=</span><span class="fl">6</span><span class="op">)</span>,</span>
<span class="r-in">               pm25<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">12</span>,<span class="fl">8</span>,<span class="fl">14</span>,<span class="fl">22</span>,<span class="fl">18</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>start<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">3L</span>,by<span class="op">=</span><span class="fl">7L</span>,length<span class="op">=</span><span class="fl">6</span><span class="op">)</span>,</span>
<span class="r-in">               end<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">9L</span>,by<span class="op">=</span><span class="fl">7L</span>,length<span class="op">=</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu">intervalaverage</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>,interval_vars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"start"</span>,<span class="st">"end"</span><span class="op">)</span>,</span>
<span class="r-in">                    value_vars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pm25"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">#also see vignette for more extensive examples</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Michael Young.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer></div>

  


  

  </body></html>

